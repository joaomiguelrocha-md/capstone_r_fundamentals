aes(label = c(after_stat(prop), "(n)")),
position = position_fill(vjust = 0.5)
) +
theme_classic()
p4_2
p4_2 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
count(uls_2024, idade_cat) |>
mutate(
prop_total = n/sum(n)
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, y = prop_total, fill = idade_cat),
position = "fill"
) +
geom_text(
aes(x = prop_total, fill = idade_cat,
label = percent(prop_total, accuracy = 1.0)
),
stat = "count",# mostrar %
position = position_fill(vjust = 0.5)
) +
theme_classic()
p4_2
p4_1 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "stack"
) +
geom_text(
aes(x = uls_2024, fill = idade_cat, label = after_stat(count)),
stat = "count",
position = position_stack(vjust = 0.5)
) +
theme_classic()
p4_1
p4_0 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "fill"
) +
geom_text(
aes(x = uls_2024, fill = idade_cat,
label = c(after_stat(count), "(n)")
),
stat = "count",
position = position_fill(vjust = 0.5)
) +
theme_classic()
p4_0
p4_0 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "fill"
) +
geom_text(
aes(x = uls_2024, fill = idade_cat,
label = after_stat(count)
),
stat = "count",
position = position_fill(vjust = 0.5)
) +
theme_classic()
p4_0
p4_0 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "fill"
) +
geom_text(
aes(
x = uls_2024,
fill = idade_cat,
label = after_stat(count)
),
stat = "count",
position = position_fill(vjust = 0.5)
) +
coord_flip() +
theme_classic()
p4_0
p4_0 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "fill"
) +
geom_text(
aes(
x = uls_2024,
fill = idade_cat,
label = after_stat(count)
),
stat = "count",
position = position_fill(vjust = 0.5)
) +
coord_flip() +
theme_classic() +
theme(
legend.title = element_blank(),
legend.position = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)
p4_0
p4_0 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "fill"
) +
geom_text(
aes(
x = uls_2024,
fill = idade_cat,
label = after_stat(count)
),
stat = "count",
position = position_fill(vjust = 0.5)
) +
coord_flip() +
theme_classic() +
theme(
legend.title = element_blank(),
legend.position = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)
p4_0
p4_0 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "fill"
) +
geom_text(
aes(
x = uls_2024,
fill = idade_cat,
label = after_stat(count)
),
stat = "count",
position = position_fill(vjust = 0.5)
) +
theme(
legend.title = element_blank(),
legend.position = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank()
) +
coord_flip() +
theme_classic() +
p4_0
p4_1 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "stack"
) +
geom_text(
aes(x = uls_2024, fill = idade_cat, label = after_stat(count)),
stat = "count",
position = position_stack(vjust = 0.5)
) +
theme_classic()
p4_0 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "fill"
) +
geom_text(
aes(
x = uls_2024,
fill = idade_cat,
label = after_stat(count)
),
stat = "count",
position = position_fill(vjust = 0.5)
) +
theme(
legend.title = element_blank(),
legend.position = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank()
) +
coord_flip() +
theme_classic() +
p4_0
p4_0 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "fill"
) +
geom_text(
aes(
x = uls_2024,
fill = idade_cat,
label = after_stat(count)
),
stat = "count",
position = position_fill(vjust = 0.5)
) +
theme(
legend.title = element_blank(),
legend.position = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank()
) +
coord_flip() +
theme_classic() +
p4_0
p4_0 <- gdh_uls |>
mutate(
idade_cat = cut(idade, c(0, 18, 65, Inf))
) |>
ggplot() +
geom_bar(
aes(x = uls_2024, fill = idade_cat),
position = "fill"
) +
geom_text(
aes(
x = uls_2024,
fill = idade_cat,
label = after_stat(count)
),
stat = "count",
position = position_fill(vjust = 0.5)
) +
theme(
legend.title = element_blank(),
legend.position = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank()
) +
coord_flip() +
theme_classic()
p4_0
gdh_model |>  t_test(idade ~ sexo)
required_packages <- c(
"tidyverse",
"rio",
"scales",
"here",
"patchwork",
"sf",
"ggthemes",
"giscoR",
"eurostat",
"sysfonts",
"showtext",
"scales",
"geodata",
"osmdata",
"leaflet",
"janitor",
"assertr",
"data.validator",
"forcats",
"data.table",
"broom",
"gt",
"gtsummary",
"glm2",
"performance",
"see",
"readxl",
"purrr",
"tibble",
"ggridges",
"tidymodels",
"tidyclust",
"factoextra",
"rstatix"
)
for (pkg in required_packages) {
if (!pkg %in% rownames(installed.packages())) {
install.packages(pkg)
}
library(pkg, character.only = TRUE)
}
for (pkg in required_packages) {
if (!pkg %in% rownames(installed.packages())) {
install.packages(pkg)
}
library(pkg, character.only = TRUE)
}
remove(required_packages)
remove(pkg)
gdh_model |>  t_test(idade ~ sexo)
d
gdh_model <- gdh_uls |>
mutate(
sexo = factor(sexo)
) |>
filter(
dias_int < 50
)
d
gdh_model <- gdh_uls |>
mutate(
sexo = as.factor(sexo)
) |>
filter(
dias_int > 0
)
gdh_base_raw <-  import("data/data_gdh/base_gdh_icd10_no_freg.csv")
#| warning: false
#| message: false
#| error: false
set.seed(123)
rm(list = ls(all.names = TRUE))
required_packages <- c(
"tidyverse",
"rio",
"scales",
"here",
"patchwork",
"sf",
"ggthemes",
"giscoR",
"eurostat",
"sysfonts",
"showtext",
"scales",
"geodata",
"osmdata",
"leaflet",
"janitor",
"assertr",
"data.validator",
"forcats",
"data.table",
"broom",
"gt",
"gtsummary",
"glm2",
"performance",
"see",
"readxl",
"purrr",
"tibble",
"ggridges",
"tidymodels",
"tidyclust",
"factoextra",
"rstatix"
)
for (pkg in required_packages) {
if (!pkg %in% rownames(installed.packages())) {
install.packages(pkg)
}
library(pkg, character.only = TRUE)
}
remove(required_packages)
remove(pkg)
gdh_base_raw <-  import("data/data_gdh/base_gdh_icd10_no_freg.csv")
code_residence <- import("data/data_gdh/codigos_residencia.csv")
geo_linkage <- import("data/data_gdh/geo_linkage_2024_v6.csv")
comm_pt <- st_read("data/map_json_portugal/concelhos_portugal_light.json")
icd10_codes <- import("data/data_gdh/codigos_diagnostico_icd10.csv")
gdh_group <- import("data/data_gdh/grupos_gdh.csv")
gdh_base_clean <- gdh_base_raw |>
clean_names() |>
rename(
cod_dist = distrito,
cod_conc = concelho,
icd10_code = cod_diagnostico
) |>
mutate(
across(c(cod_dist, cod_conc), ~sprintf("%02d", .x), .names = "{.col}_chr"),
dt_mun = paste0(cod_dist_chr, cod_conc_chr),
code_length = nchar(icd10_code),
idade_cat = cut(idade, c(0, 18, 65, Inf), right = FALSE)
) |>
filter(
idade != -1,
cod_conc_chr != "99",
cod_dist_chr != "99",
dt_mun != "9999",
sexo != "Indeterminado"
) |>
select(
-hora_urgencia,
-freguesia,
-hosp_id,
-hora_entrada)
icd10_summary <- df_summarise(icd10_codes)
icd10_codes_pt <- icd10_codes |>
clean_names() |>
rename(
descricao_pt = pt,
descricao_en = short_descp_icd_10_cm,
icd10_code = codigo_icd_10_cm
) |>
select(
icd10_code,
descricao_en,
descricao_pt
) |>
mutate(
code_length = nchar(icd10_code)
) |>
distinct(icd10_code, .keep_all = TRUE) # remove duplicados
gdh_group <- gdh_group |>
clean_names() |>
rename(
descricao_apr31 = designacao
)
code_residence <- code_residence |>
clean_names() |>
mutate(
across(c(cod_dist, cod_conc), ~sprintf("%02d", .x), .names = "{.col}_chr"),
dt_mun = paste0(cod_dist_chr, cod_conc_chr)
)
comm_pt <- comm_pt |>
rename(municipio = NAME_2, distrito = NAME_1) |>
clean_names()
geolink_target <- c("dt_mun", "distrito_2013","municipio_2013_cod", "municipio_2013", "uls_2024", "regiao_2024", "nuts3_2013", "nuts3_2013_cod", "nuts3_2024", "nuts3_2024_cod", "municipio_2024_cod", "uls_2023", "uls_hierarquia_csp")
geo_linkage_clean <- geo_linkage |>
clean_names() |>
mutate(
dt_mun = str_pad(as.character(dt_mun), 4, pad = 0),
mun_cod = str_pad(as.character(municipio_2013_cod), 2, pad = 0),
dt_cod = str_pad(as.character(distrito_2013_cod), 2, pad = 0)
) |>
select(all_of(geolink_target)) |>
distinct(dt_mun, .keep_all = TRUE) |>
rename(
municipio = municipio_2013,
distrito = distrito_2013
)
# CÓDIGOS RESIDÊNCIA
gdh_base_join <- gdh_base_clean |>
left_join(
code_residence,
by = "dt_mun"
)
# join gdh group and icd10 codes
gdh_base_join <- gdh_base_clean |>
left_join(
icd10_codes_pt, by = c("icd10_code", "code_length")
) |>
left_join(
gdh_group, by = "gcd_apr31"
)
gdh_join_final <- gdh_base_join |>
left_join(
geo_linkage_clean,
by = "dt_mun")
# Base de dados apenas com ULS Amadora/Sintra, ULS Médio Ave
gdh_uls <- gdh_join_final |>
filter(
cod_dist != 99
) |>
filter(uls_2024 %in% c("ULS de Amadora/Sintra", "ULS do Médio Ave"))
gdh_model <- gdh_uls |>
mutate(
sexo = as.factor(sexo)
) |>
filter(
dias_int > 0
)
model1 <- lm(dias_int ~ idade, data = gdh_model)
summary(model1)
model1_tidy <- tidy(model1, conf.int = TRUE)
model1_tidy
model2 <- lm(dias_int ~ idade, data = gdh_model)
summary(model2)
model3 <- lm(dias_int ~ idade + sexo, data = gdh_model)
model3_tidy <- tidy(model3, conf.int = TRUE)
model3_tidy
check_model(model3)
