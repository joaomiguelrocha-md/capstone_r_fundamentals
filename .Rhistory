"assertr",
"data.validator",
"forcats",
"data.table",
"broom",
"gt",
"gtsummary",
"glm2",
"performance",
"see",
"readxl",
"purrr""
)
for (pkg in required_packages) {
if (!pkg %in% rownames(installed.packages())) {
install.packages(pkg)
}
library(pkg, character.only = TRUE)
}
remove(required_packages)
remove(pkg)
#| warning: false
#| message: false
#| error: false
set.seed(123)
rm(list = ls(all.names = TRUE))
required_packages <- c(
"tidyverse",
"rio",
"scales",
"here",
"patchwork",
"sf",
"ggthemes",
"giscoR",
"eurostat",
"sysfonts",
"showtext",
"scales",
"geodata",
"osmdata",
"leaflet",
"janitor",
"assertr",
"data.validator",
"forcats",
"data.table",
"broom",
"gt",
"gtsummary",
"glm2",
"performance",
"see",
"readxl",
"purrr"
)
for (pkg in required_packages) {
if (!pkg %in% rownames(installed.packages())) {
install.packages(pkg)
}
library(pkg, character.only = TRUE)
}
remove(required_packages)
remove(pkg)
gdh_base_raw <-  import("data/data_gdh/base_gdh_icd10_no_freg.csv")
df_summarise <- function(df) {
n_total <- nrow(df)
df %>%
tibble::as_tibble() %>%
summarise(
variable = names(.),
type = map_chr(., ~ class(.x)[1]),
n_total = n_total,
n_distinct = map2_int(., type, ~ if (.y %in% c("character", "factor")) n_distinct(.x, na.rm = TRUE) else NA_integer_),
n_NA = map_int(., ~ sum(is.na(.x)))
) %>%
unnest(cols = c(variable, type, n_distinct, n_NA))
}
gdh_raw_summary <- df_summarise(gdh_base_raw)
df_summarise <- function(df) {
n_total <- nrow(df)
df %>%
tibble(
variable = names(df),
type = map_chr(df, ~ class(.x)[1]),
n_total = n_total,
n_distinct = map2_int(df, type, ~ if (.y %in% c("character", "factor")) n_distinct(.x, na.rm = TRUE) else NA_integer_),
n_NA = map_int(df, ~ sum(is.na(.x)))
)
}
gdh_raw_summary <- df_summarise(gdh_base_raw)
#| warning: false
#| message: false
#| error: false
set.seed(123)
rm(list = ls(all.names = TRUE))
required_packages <- c(
"tidyverse",
"rio",
"scales",
"here",
"patchwork",
"sf",
"ggthemes",
"giscoR",
"eurostat",
"sysfonts",
"showtext",
"scales",
"geodata",
"osmdata",
"leaflet",
"janitor",
"assertr",
"data.validator",
"forcats",
"data.table",
"broom",
"gt",
"gtsummary",
"glm2",
"performance",
"see",
"readxl",
"purrr",
"tibble"
)
for (pkg in required_packages) {
if (!pkg %in% rownames(installed.packages())) {
install.packages(pkg)
}
library(pkg, character.only = TRUE)
}
remove(required_packages)
remove(pkg)
gdh_base_raw <-  import("data/data_gdh/base_gdh_icd10_no_freg.csv")
df_summarise <- function(df) {
clean_names(df) |>
tibble(
variable = names(df),
type = map_chr(df, ~ class(.x)[1]),
n_total = nrow(df),
n_distinct = map_int(df, ~ if (is.character(.x) || is.factor(.x))
dplyr::n_distinct(.x, na.rm = TRUE)
else NA_integer_),
n_NA = map_int(df, ~ sum(is.na(.x)))
)
}
gdh_raw_summary <- df_summarise(gdh_base_raw)
df_summarise <- function(df) {
tibble(
variable = names(df),
type = map_chr(df, ~ class(.x)[1]),
n_total = nrow(df),
n_distinct = map_int(df, ~ if (is.character(.x) || is.factor(.x))
dplyr::n_distinct(.x, na.rm = TRUE)
else NA_integer_),
n_NA = map_int(df, ~ sum(is.na(.x)))
)
}
gdh_raw_summary <- df_summarise(gdh_base_raw)
View(gdh_raw_summary)
tabela0 <- gdh_raw_summary |>
gt()
tabela 0
tabela0
gtsave(tabela0, "tabela_limpeza_sumario.html", "html")
export(tabela0, "tabela_limpeza_sumario.html", "html")
export(x = tabela0, "tabela_limpeza_sumario.html", "html")
export(tabela0 , "tabela_limpeza_sumario.html", html)
gtsave(tabela0, filename = "tabela_limpeza.html")
tabela0
View(gdh_base_raw)
unique(gdh_base_raw$sexo)
gdh_unique <- gdh_base_raw |>
summarise(across(where(is.character), ~ list(unique(.x))))
View(gdh_unique)
gdh_unique <- gdh_base_raw |>
select(where(is.character)) |>
map(unique)
View(gdh_unique)
tabela0
gdh_base_clean <- gdh_base_raw |>
clean_names() |>
rename(
cod_dist = distrito,
cod_conc = concelho,
icd10_code = cod_diagnostico
) |>
mutate(
across(c(cod_dist, cod_conc), ~sprintf("%02d", .x), .names = "{.col}_chr"),
dt_mun = paste0(cod_dist_chr, cod_conc_chr),
code_length = nchar(icd10_code)
)
geo_linkage <- import("data/data_gdh/geo_linkage_2024_v6.csv")
comm_pt <- st_read("data/map_json_portugal/concelhos_portugal_light.json")
icd10_codes <- import("data/data_gdh/codigos_diagnostico_icd10.csv")
gdh_group <- import("data/data_gdh/grupos_gdh.csv")
View(gdh_group)
icd10_summary <- df_summarise(icd10_codes)
tabela01 <- icd10_summary |>
gt()
tabela01
View(icd10_codes)
gdh_group_summary <- df_summarise(gdh_group)
tabela02 <- gdh_group_summary |>
gt()
tabela02
df_summarise <- function(df) {
tibble(
variable = names(df),
type = map_chr(df, ~ class(.x)[1]),
n_total = nrow(df),
n_distinct = map_int(df, ~ if (is.character(.x) || is.factor(.x))
dplyr::n_distinct(.x, na.rm = TRUE) # especifica package para evitar conflito
else NA_integer_),
n_NA = map_int(df, ~ ~ {
if (is.character(.x)) {
sum(is.na(.x) | .x == "", na.rm = TRUE)  # contar NA e células em branco
} else {
sum(is.na(.x))
}
})
)
}
# Base dados gdh
# checking for NA
gdh_raw_summary <- df_summarise(gdh_base_raw)
rlang::last_trace()
df_summarise <- function(df) {
tibble(
variable = names(df),
type = map_chr(df, ~ class(.x)[1]),
n_total = nrow(df),
n_distinct = map_int(df, ~ if (is.character(.x) || is.factor(.x))
dplyr::n_distinct(.x, na.rm = TRUE) # especifica package para evitar conflito
else NA_integer_),
n_NA = map_int(df, ~ {
if (is.character(.x)) {
sum(is.na(.x) | .x == "", na.rm = TRUE)  # contar NA e células em branco
} else {
sum(is.na(.x))
}
})
)
}
# Base dados gdh
# checking for NA
gdh_raw_summary <- df_summarise(gdh_base_raw)
tabela0 <- gdh_raw_summary |>
gt()
tabela0
icd10_summary <- df_summarise(icd10_codes)
tabela01 <- icd10_summary |>
gt()
tabela01
gdh_group_summary <- df_summarise(gdh_group)
tabela02 <- gdh_group_summary |>
gt()
tabela02
gdh_base_clean <- gdh_base_raw |>
clean_names() |>
rename(
cod_dist = distrito,
cod_conc = concelho,
icd10_code = cod_diagnostico
) |>
mutate(
across(c(cod_dist, cod_conc), ~sprintf("%02d", .x), .names = "{.col}_chr"),
dt_mun = paste0(cod_dist_chr, cod_conc_chr),
code_length = nchar(icd10_code)
)
icd10_codes_pt <- icd10_codes |>
clean_names() |>
rename(
descricao_pt = pt,
descricao_en = short_descp_icd_10_cm,
icd10_code = codigo_icd_10_cm
) |>
select(
icd10_code,
descricao_en,
descricao_pt
) |>
mutate(
code_length = nchar(icd10_code)
) |>
distinct(icd10_code, .keep_all = TRUE)
# identificar duplicados (EXISTIAM!! foi necessario apagar ver distinct())
icd10_codes_pt %>%
count(icd10_code, code_length) %>%
filter(n > 1)
# join gdh group and icd10 codes
gdh_base_join <- gdh_base_clean |>
left_join(
icd10_codes_pt, by = c("icd10_code", "code_length")
) |>
left_join(
gdh_group, by = "gcd_apr31"
)
View(icd10_codes_pt)
# join grandes grupos (gcd_apr31)
#verificar duplicados - não há
gdh_group <- gdh_group |>
clean_names() |>
rename(
descricao_apr31 = designacao
)
gdh_group%>%
count(gcd_apr31) %>%
filter(n > 1)
# join gdh group and icd10 codes
gdh_base_join <- gdh_base_clean |>
left_join(
icd10_codes_pt, by = c("icd10_code", "code_length")
) |>
left_join(
gdh_group, by = "gcd_apr31"
)
# join grandes grupos (gcd_apr31)
#verificar duplicados - não há
gdh_group <- gdh_group |>
clean_names() |>
rename(
descricao_apr31 = designacao
)
geo_linkage <- geo_linkage |>
mutate(
dt_mun = str_pad(as.character(dt_mun), 4, pad = 0)
)
geolink_target <- c("dt_mun", "distrito_2013", "municipio_2013", "uls_2024", "regiao_2024", "nuts3_2013", "nuts3_2013_cod", "nuts3_2024", "nuts3_2024_cod", "municipio_2024_cod", "uls_2023", "uls_hierarquia_csp")
geo_linkage_clean <- geo_linkage |>
select(all_of(geolink_target)) |>
distinct(dt_mun, .keep_all = TRUE)
gdh_join_final <- gdh_base_join |>
left_join(
geo_linkage_clean,
by = "dt_mun")
# Base de dados apenas com ULS Amadora/Sintra, ULS Médio Ave
gdh_uls <- gdh_join_final |>
filter(uls_2024 %in% c("ULS de Amadora/Sintra", "ULS do Médio Ave"))
# Total Episódios por ULS e Tipo de episodio
total_ep_uls <- gdh_uls |>
group_by(uls_2024, adm_tip) %>%
summarise(total = n()) %>%
arrange(uls_2024)
View(total_ep_uls)
# Total Episódios por ULS e Tipo de episodio
total_ep_uls <- gdh_uls |>
group_by(uls_2024, sexo, idade, adm_tip) %>%
summarise(total = n()) %>%
arrange(uls_2024)
View(gdh_uls)
# Criar as categorias (European Standard Population (ESP) 2013 e INE)
gdh_uls <- gdh_uls |>
mutate(
idade_cat_eu = cut(
idade,
breaks = c(0, 1, 5, 10, 15, 20, 25, 30, 35, 40, 45,
50, 55, 60, 65, 70, 75, 80, 85, 90, 95, Inf),
right = FALSE), # Criar nova categoria com divisão do grupo etário do Eurostat para análise
idade_cat_ine = cut(
idade,
breaks = c(0, 5, 10, 15, 20, 25, 30, 35, 40, 45,
50, 55, 60, 65, 70, 75, 80, 85, Inf),
right = FALSE) # Criar nova categoria com divisão do grupo etário do INE para análise
)
# Total Episódios por ULS e Tipo de episodio
total_ep_uls <- gdh_uls |>
group_by(uls_2024, sexo, idade, adm_tip) %>%
summarise(total = n()) %>%
arrange(uls_2024)
# Total Episódios por ULS e Tipo de episodio
total_ep_uls <- gdh_uls |>
group_by(uls_2024, sexo, idade_cat_eu, adm_tip) %>%
summarise(total = n()) %>%
arrange(uls_2024)
# Contar total de observações por grupo etário
contagem_idade <- gdh_uls %>%
group_by(uls_2024, as.factor(sexo), idade_cat) %>%
summarise(total = n()) %>%
arrange(idade_cat)
# Contar total de observações por grupo etário
contagem_idade <- gdh_uls %>%
group_by(uls_2024, as.factor(sexo), idade_cat_ine) %>%
summarise(total = n()) %>%
arrange(idade_cat)
# Contar total de observações por grupo etário
contagem_idade <- gdh_uls %>%
group_by(uls_2024, as.factor(sexo), idade_cat_ine) %>%
summarise(total = n()) %>%
arrange(idade_cat_ine)
View(contagem_idade)
# Distribuição por sexo ULS
p1 <- total_ep_uls |>
ggplot(aes(x = idade_cat_ine, fill = sexo)) +
geom_bar() +
scale_fill_viridis_d(end = .5) +
facet_grid(~uls_2024)
# Distribuição por sexo ULS
p01 <- total_ep_uls |>
ggplot(aes(x = idade_cat_ine, fill = sexo)) +
geom_bar() +
scale_fill_viridis_d(end = .5) +
facet_grid(~uls_2024) +
theme(
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.line.x  = element_blank(),
axis.line.y = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
)
p01
View(total_ep_uls)
p0 <- ggplot(data= total_ep_uls,
aes(x= idade_cat_ine)
) +
geom_density(alpha=.4) +
facet_grid(~uls_2024)
p0 <- ggplot(data= total_ep_uls,
aes(x= idade_cat_ine)
) +
geom_density(alpha=.4) +
facet_grid(~uls_2024) +
labs(title = "Nº Episodios por grupo etário",
subtitle = "ULS Amadora/Sintra e ULS Médio Ave",
y = "Densidade",
x = "Grupo etário",
caption = "Autores:") +
theme_minimal()
p0
p0 <- ggplot(
total_ep_uls,
aes(x= idade_cat_ine)
) +
geom_density(alpha=.4) +
facet_grid(~uls_2024) +
labs(title = "Nº Episodios por grupo etário",
subtitle = "ULS Amadora/Sintra e ULS Médio Ave",
y = "Densidade",
x = "Grupo etário",
caption = "Autores:") +
theme_minimal()
p0
p0 <- ggplot(
total_ep_uls,
aes(x= idade_cat_eu)
) +
geom_density(alpha=.4) +
facet_grid(~uls_2024) +
labs(title = "Nº Episodios por grupo etário",
subtitle = "ULS Amadora/Sintra e ULS Médio Ave",
y = "Densidade",
x = "Grupo etário",
caption = "Autores:") +
theme_minimal()
p0
# Distribuição por sexo ULS
p01 <- total_ep_uls |>
ggplot(aes(x = idade_cat_eu, fill = sexo)) +
geom_bar() +
scale_fill_viridis_d(end = .5) +
facet_grid(~uls_2024) +
theme(
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.line.x  = element_blank(),
axis.line.y = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
)
p01
# Distribuição por sexo ULS
p01 <- total_ep_uls |>
ggplot(aes(x = uls_2024, fill = sexo)) +
geom_bar() +
scale_fill_viridis_d(end = .5) +
facet_grid(~uls_2024) +
theme(
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.line.x  = element_blank(),
axis.line.y = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
)
p01
# Distribuição por sexo ULS
p01 <- total_ep_uls |>
ggplot(aes(x = uls_2024, fill = sexo)) +
geom_bar() +
scale_fill_viridis_d(end = .5) +
# facet_grid(~uls_2024) +
theme(
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.line.x  = element_blank(),
axis.line.y = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
)
p01
---
title: "Capstone"
---
title: "Capstone"
---
title: "Capstone"
subtitle: "TBA"
---
title: "Capstone"
