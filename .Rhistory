getwd()
gdh_base <-  import("/data/data_gdh/base_gdh_icd10_no_freg.csv")
#| warning: false
#| message: false
#| error: false
rm(list = ls(all.names = TRUE))
required_packages <- c(
"assertr",
"data.validator",
"janitor",
"tidyverse",
"rio"
)
for (pkg in required_packages) {
if (!pkg %in% rownames(installed.packages())) {
install.packages(pkg)
}
library(pkg, character.only = TRUE)
}
remove(required_packages)
remove(pkg)
gdh_base <-  import("/data/data_gdh/base_gdh_icd10_no_freg.csv")
gdh_base <-  import("/data/data_gdh/base_gdh_icd10_no_freg")
gdh_base <-  import("/data/data_gdh/base_gdh_icd10_no_freg.csv")
library(readr)
gdh_base <- read_csv("data/data_gdh/base_gdh_icd10_no_freg.csv")
gdh_base <- clean_names(gdh_base)
View(gdh_base)
gdh_base <- read_csv2("data/data_gdh/base_gdh_icd10_no_freg.csv")
View(gdh_base)
hosp_id <- unique(gdh_base$hosp_id)
patient_id <- unique(gdh_bse$seq_number)
patient_id <- unique(gdh_base$seq_number)
gdh_base <-  import("data/data_gdh/base_gdh_icd10_no_freg.csv")
View(gdh_base)
gdh_base <- clean_names(gdh_base)
hosp_id <- gdh_base$hosp_id
hosp_id <- c(gdh_base$hosp_id)
hosp_id <- c(unique(gdh_base$hosp_id)
hosp_id <- c(gdh_base$hosp_id)
hosp_id <- c(gdh_base$hosp_id)
hosp_id <- distinct(gdh_base, hosp_id)
View(hosp_id)
patient_id <- distinct(gdh_base, seq_number)
View(patient_id)
View(patient_id)
total_patients <-
length(patient_id)
length(patient_id)
total_patients <- count(as.factor(patient_id))
total_patients <- count(as.factor(seq_number))
View(patient_id)
total_patients <- length(patient_id$seq_number)
length(patient_id$seq_number)
patient_id <- patient_id |>
mutate(
total_patients = length(patient_id$seq_number)
)
View(patient_id)
#
patient_id <- distinct(gdh_base, seq_number)
View(gdh_base)
code_residence <- import("data/data_gdh/codigos_residencia.csv")
View(code_residence)
code_residence <- code_residence |>
clean_names() |>
select(
cod_dist,
cod_conc,
des_dcf
)
View(code_residence)
tipo_adm <- distinct(gdh_base, adm_tip)
View(tipo_adm)
#| warning: false
#| message: false
#| error: false
set.seed(123)
rm(list = ls(all.names = TRUE))
required_packages <- c(
"tidyverse",
"rio",
"scales",
"here",
"patchwork",
"sf",
"ggthemes",
"giscoR",
"eurostat",
"sysfonts",
"showtext",
"scales",
"geodata",
"osmdata",
"leaflet",
"janitor",
"assertr",
"data.validator"
)
for (pkg in required_packages) {
if (!pkg %in% rownames(installed.packages())) {
install.packages(pkg)
}
library(pkg, character.only = TRUE)
}
remove(required_packages)
remove(pkg)
gdh_base_raw <-  import("data/data_gdh/base_gdh_icd10_no_freg.csv")
#| warning: false
#| message: false
#| error: false
set.seed(123)
rm(list = ls(all.names = TRUE))
required_packages <- c(
"tidyverse",
"rio",
"scales",
"here",
"patchwork",
"sf",
"ggthemes",
"giscoR",
"eurostat",
"sysfonts",
"showtext",
"scales",
"geodata",
"osmdata",
"leaflet",
"janitor",
"assertr",
"data.validator"
)
for (pkg in required_packages) {
if (!pkg %in% rownames(installed.packages())) {
install.packages(pkg)
}
library(pkg, character.only = TRUE)
}
remove(required_packages)
remove(pkg)
gdh_base_raw <-  import("data/data_gdh/base_gdh_icd10_no_freg.csv")
code_residence <- import("data/data_gdh/codigos_residencia.csv")
geo_linkage <- import("data/data_gdh/geo_linkage_2024_v6.csv")
comm_pt <- st_read("data/map_json_portugal/concelhos_portugal_light.json")
#
gdh_base_clean <- clean_names(gdh_base_raw)
str(gdh_base_clean)
code_residence <- code_residence |>
clean_names() |>
select(
cod_dist,
cod_conc,
des_dcf
)
comm_pt <- comm_pt |>
rename(geodsg = NAME_2)
# preparar base dados code_residence e  para join
code_residence <- code_residence |>
mutate(
across(c(cod_dist, cod_conc), ~sprintf("%02d", .x), .names = "{.col}_chr"),
dt_mun = paste0(cod_dist_chr, cod_conc_chr)
)
gdh_base_clean <- gdh_base_clean |>
rename(
cod_dist = distrito,
cod_conc = concelho
) |>
mutate(
across(c(cod_dist, cod_conc), ~sprintf("%02d", .x), .names = "{.col}_chr"),
dt_mun = paste0(cod_dist_chr, cod_conc_chr)
)
geo_linkage <- geo_linkage |>
mutate(
dt_mun = str_pad(as.character(dt_mun), 4, pad = 0)
)
geolink_target <- c("dt_mun", "dicofre_2025", "distrito_2013", "municipio_2013", "uls_2024", "nuts2_2024", "nuts2_2024_cod", "nuts3_2024", "nuts3_2024_cod", "regiao_2024", "freguesia_2025", "abreviatura_freguesia_2025", "fr_2025" )
geo_linkage_target <- geo_linkage |>
select(all_of(geolink_target)) |>
distinct(dt_mun, .keep_all = TRUE)
# residence_geo_join <- geo_linkage_target |>
# left_join(
#   code_residence,
#   geo_linkage_target,
#   by = "dt_mun")
gdh_geo_join <- gdh_base_clean |>
left_join(
geo_linkage_target,
by = "dt_mun")
gdh_uls <- gdh_geo_join |>
filter(uls_2024 %in% c("ULS de Amadora/Sintra", "ULS do Médio Ave")
)
View(code_residence)
View(gdh_base_raw)
View(geo_linkage)
geo_linkage <- import("data/data_gdh/geo_linkage_2024_v6.csv")
View(geo_linkage)
geo_linkage <- geo_linkage |>
mutate(
dt_mun = str_pad(as.character(dt_mun), 4, pad = 0)
)
View(gdh_base_clean)
geolink_target <- c("dt_mun", "dicofre_2025", "distrito_2013", "municipio_2013", "uls_2024", "nuts2_2024", "nuts2_2024_cod", "nuts3_2024", "nuts3_2024_cod", "regiao_2024")
geo_linkage_target <- geo_linkage |>
select(all_of(geolink_target)) |>
distinct(dt_mun, .keep_all = TRUE)
View(geo_linkage_target)
gdh_geo_join <- gdh_base_clean |>
left_join(
geo_linkage_target,
by = "dt_mun")
gdh_uls <- gdh_geo_join |>
filter(uls_2024 %in% c("ULS de Amadora/Sintra", "ULS do Médio Ave")
)
View(gdh_uls)
p1 <- gdh_uls |>
ggplot(aes(x = uls_2024, fill = sexo)) +
geom_bar() +
scale_fill_viridis_d(end = .5) +
theme(
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.line.x  = element_blank(),
axis.line.y = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
)
p1
str(gdh_uls)
p2 <- gdh_uls %>%
count(as.factors(severidade_apr31)) %>%
mutate(freq = (n / sum(n))) %>%
mutate(cum = cumsum(freq)) %>%
ggplot(aes(x = "", y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr_31")
p2 <- gdh_uls %>%
count(as.factor(severidade_apr31)) %>%
mutate(freq = (n / sum(n))) %>%
mutate(cum = cumsum(freq)) %>%
ggplot(aes(x = "", y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr_31")
p2
p2 <- gdh_uls %>%
count(as.factor(severidade_apr31)) %>%
mutate(freq = (n / sum(n))) %>%
mutate(cum = cumsum(freq)) %>%
ggplot(aes(x = "", y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31")
p2
p2 <- gdh_uls %>%
count(as.factor(severidade_apr31)) %>%
mutate(freq = (n / sum(n))) %>%
mutate(cum = cumsum(freq)) %>%
ggplot(aes(x = "", y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "count") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31")
p2
p2 <- gdh_uls |>
count(as.factor("severidade_apr31"))  |>
mutate(freq = (n / sum(n))) %>%
mutate(cum = cumsum(freq)) %>%
ggplot(aes(x = "", y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "count") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31")
p2
p2 <- gdh_uls |>
count(severidade_apr31)  |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(aes(x = "", y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "identitiy") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31")
p2 <- gdh_uls |>
count(severidade_apr31)  |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(aes(x = "", y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31")
p2
p2 <- gdh_uls |>
count(severidade_apr31)  |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(aes(x = uls_2024, y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31")
p2
p2 <- gdh_uls |>
count(severidade_apr31)  |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(aes(x = "uls_2024", y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31")
p2
View(gdh_uls)
p2 <- gdh_uls |>
count(severidade_apr31)  |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(aes(x = uls_2024, y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31")
p2
p2 <- gdh_uls |>
count(severidade_apr31)  |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(aes(x = as.factor(uls_2024), y = freq, fill = severidade_apr31, label = freq)) +
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31")
p2
p2 <- gdh_uls |>
count(uls_2024, severidade_apr31)  |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(
aes(x = uls_2024, y = freq, fill = severidade_apr31, label = scales::percent(fre))
)+
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(labs(fill = "severidade_apr31", y = "Proportion", x = "ULS 2024") +
scale_y_continuous(labels = scales::percent_format()))
p2 <- gdh_uls |>
count(uls_2024, severidade_apr31)  |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(
aes(x = uls_2024, y = freq, fill = severidade_apr31, label = scales::percent(freq))
)+
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(labs(fill = "severidade_apr31", y = "Proportion", x = "ULS 2024") +
scale_y_continuous(labels = scales::percent_format()))
p2 <- gdh_uls |>
count(uls_2024, severidade_apr31)  |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(
aes(x = uls_2024, y = freq, fill = severidade_apr31)
)+
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(labs(fill = "severidade_apr31", y = "Proportion", x = "ULS 2024") +
scale_y_continuous(labels = scales::percent_format()))
p2 <- gdh_uls |>
p2 <- gdh_uls |>
count(uls_2024, severidade_apr31)  |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(
aes(x = uls_2024, y = freq, fill = severidade_apr31)
)+
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31", y = "Proportion", x = "ULS 2024")
p2 <- gdh_uls |>
count(uls_2024, severidade_apr31) |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(
aes(x = uls_2024, y = freq, fill = severidade_apr31)
)+
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31", y = "Proportion", x = "ULS 2024")
p2
p1
p3 <- gdh_uls |>
count(uls_2024, mortalidade_apr31) |>
mutate(freq = (n / sum(n))) |>
mutate(cum = cumsum(freq)) |>
ggplot(
aes(x = uls_2024, y = freq, fill = severidade_apr31)
)+
geom_bar(position = "stack", stat = "identity") +
scale_fill_viridis_d(end = .5) +
geom_text(aes(label = freq), position = position_stack(vjust = .95), colour = "white") +
labs(fill = "severidade_apr31", y = "Proportion", x = "ULS 2024")
p3
p1 <- gdh_uls |>
ggplot(aes(x = uls_2024, fill = sexo)) +
geom_bar() +
scale_fill_viridis_d(end = .5) +
theme(
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.line.x  = element_blank(),
axis.line.y = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
)
p1 <- gdh_uls |>
ggplot(aes(x = uls_2024, fill = sexo)) +
geom_bar() +
scale_fill_viridis_d(end = .5) +
theme(
# axis.text.y = element_blank(),
# axis.ticks.y = element_blank(),
axis.line.x  = element_blank(),
axis.line.y = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
)
p1
p2
